5â€‘1. React Native â€“ ëª…ì–¸ & í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ í™”ë©´
// src/screens/DailyScreen.tsx import React, { useEffect, useState } from 'react'; import { View, Text, StyleSheet, ScrollView, ActivityIndicator } from 'react-native'; import YoutubePlayer from 'react-native-youtube-iframe'; import messaging from '@react-native-firebase/messaging'; type Quote = { content: string; author: string; }; type Props = { route: { params: { quote: Quote; videoIds: string[]; }; }; }; export default function DailyScreen({ route }: Props) { const { quote, videoIds } = route.params; const [ready, setReady] = useState(false); useEffect(() => { // optional: preâ€‘fetch video details if needed }, []); if (!quote) { return ( <View style={styles.center}> <ActivityIndicator size="large" /> </View> ); } return ( <ScrollView contentContainerStyle={styles.container}> {/* ëª…ì–¸ ì¹´ë“œ */} <View style={styles.quoteCard}> <Text style={styles.quoteText}>â€œ{quote.content}â€</Text> <Text style={styles.author}>â€” {quote.author}</Text> </View> {/* í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ */} <Text style={styles.sectionTitle}>ì˜¤ëŠ˜ì˜ ë™ê¸°ë¶€ì—¬ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸</Text> {videoIds.map((vid) => ( <View key={vid} style={styles.videoWrapper}> <YoutubePlayer height={200} play={false} videoId={vid} onReady={() => setReady(true)} /> </View> ))} </ScrollView> ); } // ìŠ¤íƒ€ì¼ ìƒëµ (ê°„ë‹¨íˆ ì ìš©) const styles = StyleSheet.create({ container: { padding: 16 }, quoteCard: { backgroundColor: '#fff', padding: 20, borderRadius: 12, marginBottom: 24, elevation: 3 }, quoteText: { fontSize: 20, fontStyle: 'italic', textAlign: 'center' }, author: { marginTop: 10, fontSize: 16, textAlign: 'right' }, sectionTitle: { fontSize: 18, fontWeight: '600', marginBottom: 12 }, videoWrapper: { marginBottom: 20 }, center: { flex: 1, justifyContent: 'center', alignItems: 'center' }, });
5â€‘2. ë°±ì—”ë“œ â€“ ë§¤ì¼ ì•Œë¦¼ ì „ì†¡ (Node.js + TypeScript)
// src/server.ts import express from 'express'; import admin from 'firebase-admin'; import cron from 'node-cron'; import { getQuote } from './services/quoteService'; import { getPlaylist } from './services/youtubeService'; import { getUsersWithSchedule } from './services/userService'; admin.initializeApp({ credential: admin.credential.applicationDefault(), }); const app = express(); app.use(express.json()); // ë§¤ 1ë¶„ë§ˆë‹¤ ì‹¤í–‰ (ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” 5ë¶„ ë‹¨ìœ„ ì •ë„ë¡œë„ OK) cron.schedule('*/1 * * * *', async () => { console.log('ğŸ”” ìŠ¤ì¼€ì¤„ëŸ¬ ì‘ë™ ì¤‘...'); const users = await getUsersWithSchedule(); // {uid, fcmToken, scheduleTime} const now = new Date(); const hour = now.getHours(); const minute = now.getMinutes(); for (const user of users) { const [sh, sm] = user.scheduleTime.split(':').map(Number); if (sh === hour && sm === minute) { try { const quote = await getQuote(); // {content, author} const videoIds = await getPlaylist('motivational music', 7); const message = { token: user.fcmToken, notification: { title: 'ì˜¤ëŠ˜ì˜ ë™ê¸°ë¶€ì—¬', body: `"${quote.content}" - ${quote.author}`, }, data: { quote: JSON.stringify(quote), videos: videoIds.join(','), // ìµœëŒ€ 7ê°œ ì •ë„ }, }; await admin.messaging().send(message); console.log(`âœ… ${user.uid}ì—ê²Œ ì•Œë¦¼ ì „ì†¡`); } catch (e) { console.error('âš ï¸ ì•Œë¦¼ ì „ì†¡ ì‹¤íŒ¨', e); } } } }); app.listen(3000, () => console.log('ğŸš€ API ì„œë²„ ì‹¤í–‰ ì¤‘: http://localhost:3000'));
quoteService.ts
import fetch from 'node-fetch'; export async function getQuote() { const resp = await fetch('https://api.quotable.io/random'); const data = await resp.json(); return { content: data.content, author: data.author }; }
youtubeService.ts
import { google } from 'googleapis'; const youtube = google.youtube({ version: 'v3', auth: process.env.YOUTUBE_API_KEY, }); export async function getPlaylist(query: string, max = 7) { const searchRes = await youtube.search.list({ q: query, part: ['id'], maxResults: max, type: ['video'], videoCategoryId: '10', // Music }); const videoIds = (searchRes.data.items || []).map((i) => i.id?.videoId).filter(Boolean) as string[]; return videoIds; }
userService.ts
import { Firestore } from '@google-cloud/firestore'; const db = new Firestore(); export async function getUsersWithSchedule() { const snap = await db.collection('users').where('settings.enabled', '==', true).get(); return snap.docs.map((doc) => ({ uid: doc.id, fcmToken: doc.get('settings.fcmToken'), scheduleTime: doc.get('settings.time'), // "07:00" í˜•íƒœ })); }
5â€‘3. ëª¨ë°”ì¼ â€“ ì•Œë¦¼ ìˆ˜ì‹  ë° í™”ë©´ ì´ë™
// src/App.tsx (í•µì‹¬ ë¶€ë¶„) import messaging from '@react-native-firebase/messaging'; import { NavigationContainer } from '@react-navigation/native'; import { createStackNavigator } from '@react-navigation/stack'; import DailyScreen from './screens/DailyScreen'; import HomeScreen from './screens/HomeScreen'; const Stack = createStackNavigator(); function App() { useEffect(() => { // ê¶Œí•œ ìš”ì²­ (iOS) messaging() .requestPermission() .then((authStatus) => { console.log('Permission status:', authStatus); }); // í¬ê·¸ë¼ìš´ë“œ ë©”ì‹œì§€ í•¸ë“¤ë§ const unsubscribe = messaging().onMessage(async (remoteMessage) => { // ì§ì ‘ UI íŒì—…ì„ ë„ìš°ê±°ë‚˜ ë°”ë¡œ ì´ë™ handleRemote(remoteMessage); }); // ë°±ê·¸ë¼ìš´ë“œ/ì¢…ë£Œ ìƒíƒœì—ì„œ í´ë¦­ ì‹œ messaging().onNotificationOpenedApp((remoteMessage) => { handleRemote(remoteMessage); }); // ì•±ì´ ì²˜ìŒ ì—´ë¦´ ë•Œ ì•Œë¦¼ìœ¼ë¡œ ì‹œì‘í–ˆëŠ”ì§€ í™•ì¸ messaging() .getInitialNotification() .then((remoteMessage) => { if (remoteMessage) handleRemote(remoteMessage); }); return unsubscribe; }, []); const handleRemote = (msg: any) => { const quote = JSON.parse(msg.data.quote); const videos = msg.data.videos?.split(',') ?? []; navigationRef.current?.navigate('Daily', { quote, videoIds: videos }); }; return ( <NavigationContainer ref={navigationRef}> <Stack.Navigator initialRouteName="Home"> <Stack.Screen name="Home" component={HomeScreen} /> <Stack.Screen name="Daily" component={DailyScreen} /> </Stack.Navigator> </NavigationContainer> ); }